<%@page import="org.json.JSONObject"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ page import="java.util.ArrayList"%>
<%@ page import="TodoBoard.Board"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>


<!DOCTYPE html>
<html>



<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script>
window.addEventListener("load", test);
function test(){
	$.ajax({
		type:"get",
		url:"/TodoTeamProject/mainData",
		dataType:"json",
		success:function(data){
			output='';
			$.each(data,function(){
				output+= '<span>';
				output+= '<p class="code">' + this.code + "</p>";
				output+= '<p class="contnets">' + this.contents + "</p>";
				output+= '<button>수정</button><button class="deleteButton">삭제</button><br>';
				output+= '</span>';
			});
			document.getElementById('disp').innerHTML = output;
		}
	});
}


function addList(){
	
	 
	let contents = $("input[name='contents']").val();

	
	$.ajax({
		type:"post",
		url:"/TodoTeamProject/register",
		data: "contents="+ contents,
		dataType:"text",
		success:function(data){
			
		  		let output = '';
				output+= '<span>';
				output+= '<p class="contents">'+ contents + '</p>';
				output+= '<button>수정</button><button class="deleteButton">삭제</button><br>';
				output+= '</span>';
	
			$("#disp").append(output);
		
			alert(data);
			
		} ,
		error: function(err){
			alert("요청에 실패했습니다");
		}
	});

}

$(document).on('click', '.deleteButton', function() {
	$(this).closest('span').remove();    
	let code = $(this).closest('span').find('p.code').text().trim();
    deleteList(code);
 
});

function deleteList(code){
	
	$.ajax({
        type: "post",
        url: "/TodoTeamProject/delete",
        data: "code=" + code,
        dataType: "text",
        success: function(data) {
          
        	alert(code);
        	
        	
            $(code).remove(); 
        },
        error: function(err) {
            alert("삭제 요청에 실패했습니다.");
        }
    });
}

    </script>
</head>
<body>

<div id="disp"></div>
<input type="text" name = "contents">
<button onclick="addList()">추가</button>




</body>
</html>